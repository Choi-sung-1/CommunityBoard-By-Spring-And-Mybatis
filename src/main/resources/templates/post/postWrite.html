<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="utf-8">
    <title>게시글 작성</title>
    <link th:href="@{/css/bootstrap.min.css}" href="/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/post/postWrite.css}">
</head>
<body>

<div class="card">
    <div class="form-header">
        📝 게시글 작성
    </div>

    <h5 th:if="${loginMember == null}" class="text-danger">로그인 후 이용해주세요.</h5>
    <h6 th:if="${loginMember != null}" th:text="|로그인 사용자 : ${loginMember.memberLoginId}|" class="text-muted mb-3"></h6>

    <form id="postForm" name="postForm" method="post" th:object="${postVO}" enctype="multipart/form-data">

        <!-- 제목 -->
        <div class="mb-3">
            <label for="postTitle" class="form-label">제목</label>
            <input th:field="*{postTitle}" th:classappend="${#fields.hasErrors('postTitle')} ? ' is-invalid' : ''"
                   type="text" id="postTitle" class="form-control" placeholder="제목을 입력해주세요.">
            <div class="field-error" th:errors="*{postTitle}">postTitle Error</div>
        </div>

        <!-- 이미지 업로드 -->
        <div class="mb-3">
            <label for="imageInput" class="form-label">이미지 첨부</label>
            <input type="file" id="imageInput" name="imageFiles" accept="image/*" multiple class="form-control"
                   onchange="previewImages(event)">
            <div id="previewCard" class="mt-3 d-flex flex-wrap"></div>
        </div>

        <!-- 내용 -->
        <div class="mb-3">
            <label for="postContent" class="form-label">내용</label>
            <textarea id="postContent" rows="6" th:classappend="${#fields.hasErrors('postContent')} ? ' is-invalid' : ''"
                      th:field="*{postContent}" class="form-control" placeholder="내용을 2글자 이상 입력해주세요."></textarea>
            <div class="field-error" th:errors="*{postContent}">postContent Error</div>
        </div>

        <!-- 위치 선택 -->
        <div id="container" class="mb-3" hidden>
            <label class="form-label">위치 선택</label>
            <div id="map" style="width: 100%; height: 250px;" class="mb-2 border rounded"></div>
            <div id="result" class="mb-2 text-muted">🗺️ 지도 클릭 시 정보 표시</div>
            <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-primary btn-custom" onclick="selectLocation()">선택</button>
                <button type="button" class="btn btn-outline-secondary btn-custom" onclick="cancelLocation()">취소</button>
            </div>
        </div>

        <!-- 현재 위치 표시 -->
        <div id="locDiv" class="mb-3">
            <label class="form-label">📍 장소</label>
            <div id="currentAddress" class="mb-2" th:field="*{postRegisterLocation}"></div>
            <input type="hidden" th:field="*{postRegisterLocation}" id="postRegisterLocation">
            <button type="button" class="btn btn-outline-primary btn-custom" onclick="showMap()">위치선택</button>
        </div>

        <!-- 버튼 영역 -->
        <div class="d-flex justify-content-end gap-2 mt-4">
            <a th:href="@{/post/list}" class="btn btn-outline-secondary btn-custom">목록으로</a>
            <button type="submit" class="btn btn-success btn-custom">작성하기</button>
        </div>
    </form>
</div>

<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1553256d332dc51b9fb4eb124bdfb16d&libraries=services"></script>
<script th:src="@{/js/post/postWrite.js}"></script>
</body>
</html>
